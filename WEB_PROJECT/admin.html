<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard - BookMyShow</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="styles.css">
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;600;700&display=swap" rel="stylesheet">
</head>
<body>
    <!-- Navigation Bar -->
    <nav class="navbar navbar-expand-lg">
        <div class="container-fluid">
            <a class="navbar-brand" href="home.html">ShowBuzz</a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item"><a class="nav-link" href="home.html">Home</a></li>
                    <li class="nav-item"><a class="nav-link" href="#" onclick="logout()">Logout</a></li>
                </ul>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <div class="container">
        <h1>Admin Dashboard</h1>

        <div class="section">
            <h2>Manage Movies</h2>
            <form id="addMovieForm" class="row g-3">
                <div class="col-md-6">
                    <input type="text" class="form-control" id="movieTitle" placeholder="Title" required>
                </div>
                <div class="col-md-6">
                    <textarea class="form-control" id="movieDescription" placeholder="Description" required></textarea>
                </div>
                <div class="col-md-6">
                    <input type="text" class="form-control" id="movieTrailerUrl" placeholder="Trailer URL">
                </div>
                <div class="col-md-6">
                    <input type="text" class="form-control" id="moviePosterUrl" placeholder="Poster URL">
                </div>
                <div class="col-md-3">
                    <input type="number" class="form-control" id="movieRating" step="0.1" min="0" max="10" placeholder="Rating">
                </div>
                <div class="col-md-3">
                    <input type="text" class="form-control" id="movieLanguage" placeholder="Language">
                </div>
                <div class="col-md-3">
                    <input type="text" class="form-control" id="movieDuration" placeholder="Duration">
                </div>
                <div class="col-md-3">
                    <input type="text" class="form-control" id="movieGenre" placeholder="Genre">
                </div>
                <div class="col-md-6">
                    <input type="date" class="form-control" id="movieReleaseDate" placeholder="Release Date">
                </div>
                <div class="col-md-6">
                    <button type="submit" class="btn btn-primary w-100">Add Movie</button>
                </div>
            </form>
            <table id="moviesTable" class="table table-bordered mt-3">
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>Title</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody></tbody>
            </table>
        </div>

        <div class="section">
            <h2>Manage Theaters</h2>
            <form id="addTheaterForm" class="row g-3">
                <div class="col-md-6">
                    <input type="text" class="form-control" id="theaterName" placeholder="Theater Name" required>
                </div>
                <div class="col-md-6">
                    <button type="submit" class="btn btn-primary w-100">Add Theater</button>
                </div>
            </form>
            <table id="theatersTable" class="table table-bordered mt-3">
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>Name</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody></tbody>
            </table>
        </div>

        <div class="section">
            <h2>View Bookings</h2>
            <table id="bookingsTable" class="table table-bordered">
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>User</th>
                        <th>Movie</th>
                        <th>Theater</th>
                        <th>Timing</th>
                        <th>Seats</th>
                        <th>Cost</th>
                        <th>Date</th>
                    </tr>
                </thead>
                <tbody></tbody>
            </table>
        </div>

        <div class="section">
            <h2>Manage Users</h2>
            <table id="usersTable" class="table table-bordered">
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>Username</th>
                        <th>Role</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody></tbody>
            </table>
        </div>
    </div>

    <!-- Footer -->
    <footer>
        <p>Â© 2025 BookMyShow Clone. All Rights Reserved.</p>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        function loadMovies() {
            fetch('http://localhost:8080/web_project/backend/api.php?action=movies')
                .then(response => response.json())
                .then(movies => {
                    const tbody = document.querySelector('#moviesTable tbody');
                    tbody.innerHTML = '';
                    movies.forEach(movie => {
                        const row = document.createElement('tr');
                        row.innerHTML = `<td>${movie.id}</td><td>${movie.title}</td><td>
                            <button onclick="editMovie(${movie.id}, '${movie.title}', '${movie.description}', '${movie.trailer_url}', '${movie.poster_url}', ${movie.rating}, '${movie.language}', '${movie.duration}', '${movie.genre}', '${movie.release_date}')">Edit</button>
                            <button onclick="deleteMovie(${movie.id})">Delete</button></td>`;
                        tbody.appendChild(row);
                    });
                });
        }

        function addMovie() {
            const data = {
                title: document.getElementById('movieTitle').value,
                description: document.getElementById('movieDescription').value,
                trailer_url: document.getElementById('movieTrailerUrl').value,
                poster_url: document.getElementById('moviePosterUrl').value,
                rating: parseFloat(document.getElementById('movieRating').value) || 0.0,
                language: document.getElementById('movieLanguage').value,
                duration: document.getElementById('movieDuration').value,
                genre: document.getElementById('movieGenre').value,
                release_date: document.getElementById('movieReleaseDate').value || new Date().toISOString().split('T')[0]
            };
            fetch('http://localhost:8080/web_project/backend/api.php?action=add_movie', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(data)
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) loadMovies();
                alert(data.error || 'Movie added successfully');
            });
        }

        function editMovie(id, title, description, trailer_url, poster_url, rating, language, duration, genre, release_date) {
            const newTitle = prompt('Enter new title', title) || title;
            const newDescription = prompt('Enter new description', description) || description;
            const newTrailerUrl = prompt('Enter new trailer URL', trailer_url) || trailer_url;
            const newPosterUrl = prompt('Enter new poster URL', poster_url) || poster_url;
            const newRating = prompt('Enter new rating (0-10)', rating) || rating;
            const newLanguage = prompt('Enter new language', language) || language;
            const newDuration = prompt('Enter new duration', duration) || duration;
            const newGenre = prompt('Enter new genre', genre) || genre;
            const newReleaseDate = prompt('Enter new release date (YYYY-MM-DD)', release_date) || release_date;

            const data = {
                id, title: newTitle, description: newDescription, trailer_url: newTrailerUrl,
                poster_url: newPosterUrl, rating: parseFloat(newRating), language: newLanguage,
                duration: newDuration, genre: newGenre, release_date: newReleaseDate
            };
            fetch('http://localhost:8080/web_project/backend/api.php?action=update_movie', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(data)
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) loadMovies();
                alert(data.error || 'Movie updated successfully');
            });
        }

        function deleteMovie(movieId) {
            if (confirm('Are you sure you want to delete this movie?')) {
                fetch(`http://localhost:8080/web_project/backend/api.php?action=delete_movie&movie_id=${movieId}`, {
                    method: 'DELETE'
                })
                .then(response => response.json())
                .then(data => {
                    if (data.success) loadMovies();
                    alert(data.error || 'Movie deleted successfully');
                });
            }
        }

        function loadTheaters() {
            fetch('http://localhost:8080/web_project/backend/api.php?action=theaters')
                .then(response => response.json())
                .then(theaters => {
                    const tbody = document.querySelector('#theatersTable tbody');
                    tbody.innerHTML = '';
                    theaters.forEach(theater => {
                        const row = document.createElement('tr');
                        row.innerHTML = `<td>${theater.id}</td><td>${theater.name}</td><td>
                            <button onclick="editTheater(${theater.id}, '${theater.name}')">Edit</button>
                            <button onclick="deleteTheater(${theater.id})">Delete</button></td>`;
                        tbody.appendChild(row);
                    });
                });
        }

        function addTheater() {
            const name = document.getElementById('theaterName').value;
            fetch('http://localhost:8080/web_project/backend/api.php?action=add_theater', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ name })
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) loadTheaters();
                alert(data.error || 'Theater added successfully');
            });
        }

        function editTheater(id, name) {
            const newName = prompt('Enter new theater name', name) || name;
            fetch('http://localhost:8080/web_project/backend/api.php?action=update_theater', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ id, name: newName })
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) loadTheaters();
                alert(data.error || 'Theater updated successfully');
            });
        }

        function deleteTheater(theaterId) {
            if (confirm('Are you sure you want to delete this theater?')) {
                fetch(`http://localhost:8080/web_project/backend/api.php?action=delete_theater&theater_id=${theaterId}`, {
                    method: 'DELETE'
                })
                .then(response => response.json())
                .then(data => {
                    if (data.success) loadTheaters();
                    alert(data.error || 'Theater deleted successfully');
                });
            }
        }

        function loadBookings() {
            fetch('http://localhost:8080/web_project/backend/api.php?action=bookings')
                .then(response => response.json())
                .then(bookings => {
                    const tbody = document.querySelector('#bookingsTable tbody');
                    tbody.innerHTML = '';
                    bookings.forEach(booking => {
                        const row = document.createElement('tr');
                        row.innerHTML = `<td>${booking.id}</td><td>${booking.username}</td><td>${booking.movie_title}</td><td>${booking.theater_name}</td><td>${booking.timing}</td><td>${booking.seats}</td><td>$${booking.total_cost}</td><td>${booking.booking_date}</td>`;
                        tbody.appendChild(row);
                    });
                });
        }

        function loadUsers() {
            fetch('http://localhost:8080/web_project/backend/api.php?action=users')
                .then(response => response.json())
                .then(users => {
                    const tbody = document.querySelector('#usersTable tbody');
                    tbody.innerHTML = '';
                    users.forEach(user => {
                        const row = document.createElement('tr');
                        row.innerHTML = `<td>${user.id}</td><td>${user.username}</td><td>${user.role}</td><td><button onclick="deleteUser(${user.id})">Delete</button></td>`;
                        tbody.appendChild(row);
                    });
                });
        }

        function deleteUser(userId) {
            if (confirm('Are you sure you want to delete this user?')) {
                fetch(`http://localhost:8080/web_project/backend/api.php?action=delete_user&user_id=${userId}`, {
                    method: 'DELETE'
                })
                .then(response => response.json())
                .then(data => {
                    if (data.success) loadUsers();
                    alert(data.error || 'User deleted successfully');
                });
            }
        }

        document.getElementById('addMovieForm').addEventListener('submit', function(e) {
            e.preventDefault();
            addMovie();
        });
        document.getElementById('addTheaterForm').addEventListener('submit', function(e) {
            e.preventDefault();
            addTheater();
        });

        window.onload = function() {
            loadMovies();
            loadTheaters();
            loadBookings();
            loadUsers();
        };
    </script>
</body>
</html>